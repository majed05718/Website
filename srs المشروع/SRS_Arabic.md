# مواصفات متطلبات البرمجيات (SRS)

## نظام إدارة العقارات

**الإصدار:** 1.0  
**التاريخ:** 8 نوفمبر 2025  
**تم الإعداد بواسطة:** فريق محللي البرمجيات

---

## جدول المحتويات

1. [المقدمة](#1-المقدمة)
   - 1.1 [الغرض](#11-الغرض)
   - 1.2 [النطاق](#12-النطاق)
   - 1.3 [التعريفات والمختصرات](#13-التعريفات-والمختصرات)
   - 1.4 [نظرة عامة](#14-نظرة-عامة)
2. [الوصف العام](#2-الوصف-العام)
   - 2.1 [منظور المنتج](#21-منظور-المنتج)
   - 2.2 [فئات المستخدمين وخصائصهم](#22-فئات-المستخدمين-وخصائصهم)
   - 2.3 [بيئة التشغيل](#23-بيئة-التشغيل)
   - 2.4 [قيود التصميم والتنفيذ](#24-قيود-التصميم-والتنفيذ)
3. [مميزات النظام](#3-مميزات-النظام)
   - 3.1 [المصادقة والتفويض](#31-المصادقة-والتفويض)
   - 3.2 [إدارة العقارات](#32-إدارة-العقارات)
   - 3.3 [إدارة علاقات العملاء (CRM)](#33-إدارة-علاقات-العملاء-crm)
   - 3.4 [إدارة المواعيد](#34-إدارة-المواعيد)
   - 3.5 [إدارة العقود](#35-إدارة-العقود)
   - 3.6 [إدارة المدفوعات](#36-إدارة-المدفوعات)
   - 3.7 [إدارة الصيانة](#37-إدارة-الصيانة)
   - 3.8 [التقارير المالية والتحليلات](#38-التقارير-المالية-والتحليلات)
   - 3.9 [نظام استيراد/تصدير Excel](#39-نظام-استيرادتصدير-excel)
   - 3.10 [تكامل واتساب](#310-تكامل-واتساب)
   - 3.11 [لوحة التحليلات](#311-لوحة-التحليلات)
4. [متطلبات الواجهات الخارجية](#4-متطلبات-الواجهات-الخارجية)
   - 4.1 [واجهات المستخدم](#41-واجهات-المستخدم)
   - 4.2 [واجهات البرمجيات](#42-واجهات-البرمجيات)
   - 4.3 [واجهات الاتصال](#43-واجهات-الاتصال)
5. [المتطلبات غير الوظيفية](#5-المتطلبات-غير-الوظيفية)
   - 5.1 [متطلبات الأداء](#51-متطلبات-الأداء)
   - 5.2 [متطلبات الأمان](#52-متطلبات-الأمان)
   - 5.3 [متطلبات الموثوقية](#53-متطلبات-الموثوقية)
   - 5.4 [متطلبات قابلية الصيانة](#54-متطلبات-قابلية-الصيانة)
   - 5.5 [متطلبات قابلية الاستخدام](#55-متطلبات-قابلية-الاستخدام)

---

## 1. المقدمة

### 1.1 الغرض

توفر هذه الوثيقة (مواصفات متطلبات البرمجيات - SRS) وصفًا شاملاً لنظام **إدارة العقارات**. الغرض من هذه الوثيقة هو:

- تحديد جميع المتطلبات الوظيفية وغير الوظيفية للنظام
- العمل كمرجع للمطورين والمختبرين وأصحاب المصلحة
- إنشاء فهم واضح لقدرات النظام وقيوده
- توفير أساس لتخطيط المشروع والتحقق من صحته

الجمهور المستهدف يشمل:
- أعضاء فريق التطوير
- مهندسي ضمان الجودة
- مديري المشاريع
- مسؤولي النظام
- أصحاب المصلحة التجارية
- المستخدمين النهائيين

### 1.2 النطاق

نظام إدارة العقارات هو منصة شاملة قائمة على الويب مصممة لتبسيط وأتمتة عمليات المكاتب العقارية. يشمل النظام القدرات الرئيسية التالية:

**الوظائف الأساسية:**
- إدارة دورة حياة العقار كاملة (الإدراج، التتبع، المبيعات/الإيجار)
- إدارة علاقات العملاء مع تتبع التفاعلات
- جدولة المواعيد مع اكتشاف التعارضات
- إدارة العقود مع تتبع المدفوعات
- التقارير المالية والتحليلات
- إدارة طلبات الصيانة
- قدرات استيراد وتصدير Excel/CSV
- تكامل واتساب لاتصال العملاء

**الفوائد:**
- تقليل الأعمال الورقية والإدخال اليدوي للبيانات
- تحسين خدمة العملاء ووقت الاستجابة
- رؤية محسّنة لعمليات الأعمال
- تذكيرات وإشعارات آلية
- اتخاذ قرارات مبنية على البيانات من خلال التحليلات
- سير عمل مبسط لإنتاجية الموظفين

**خارج النطاق:**
- تطبيقات الهاتف المحمول الأصلية (iOS/Android)
- التكامل مع برامج محاسبة خارجية (باستثناء التصدير الأساسي)
- خوارزميات تقييم العقارات
- حاسبة الرهن العقاري
- توليد المستندات القانونية

### 1.3 التعريفات والمختصرات

| المصطلح | التعريف |
|---------|----------|
| **API** | واجهة برمجة التطبيقات - واجهة للاتصال بين مكونات البرمجيات |
| **CRM** | إدارة علاقات العملاء - نظام لإدارة تفاعلات العملاء |
| **CSV** | قيم مفصولة بفواصل - صيغة ملف لتبادل البيانات |
| **DTO** | كائن نقل البيانات - كائن ينقل البيانات بين العمليات |
| **JWT** | رمز ويب JSON - معيار للمصادقة الآمنة |
| **KPI** | مؤشر الأداء الرئيسي - قيمة قابلة للقياس توضح الفعالية |
| **NestJS** | إطار عمل Node.js تقدمي لبناء تطبيقات من جانب الخادم |
| **Next.js** | إطار عمل React لتطبيقات ويب على مستوى الإنتاج |
| **ORM** | تعيين العلاقات الكائنية - تقنية لتحويل البيانات بين الأنظمة |
| **REST** | نقل الحالة التمثيلية - نمط معماري لخدمات الويب |
| **RLS** | أمان مستوى الصف - ميزة أمان قاعدة البيانات |
| **RTL** | من اليمين إلى اليسار - اتجاه النص للغة العربية |
| **SRS** | مواصفات متطلبات البرمجيات |
| **TypeORM** | مكتبة ORM لـ TypeScript و JavaScript |
| **UI/UX** | واجهة المستخدم / تجربة المستخدم |
| **UUID** | معرف فريد عالمي |

### 1.4 نظرة عامة

تتكون وثيقة SRS هذه من خمسة أقسام رئيسية:

1. **المقدمة** - توفر السياق ونظرة عامة على الوثيقة
2. **الوصف العام** - يصف النظام من منظور عالي المستوى
3. **مميزات النظام** - تفصيل المتطلبات الوظيفية المحددة لكل ميزة
4. **متطلبات الواجهة الخارجية** - تحدد مواصفات الواجهة
5. **المتطلبات غير الوظيفية** - تحدد سمات الجودة والقيود

---

## 2. الوصف العام

### 2.1 منظور المنتج

نظام إدارة العقارات هو تطبيق ويب مستقل ومكتفي ذاتيًا مصمم للعمل بشكل مستقل مع توفير قدرات التكامل مع الخدمات الخارجية. تتكون بنية النظام من:

**طبقة الواجهة الأمامية (Next.js):**
- واجهة ويب حديثة ومتجاوبة
- قدرات تطبيق الويب التقدمي (PWA)
- إدارة الحالة من جانب العميل باستخدام Zustand
- التحديثات والإشعارات في الوقت الفعلي
- يدعم اللغتين العربية (RTL) والإنجليزية

**طبقة الخادم (NestJS):**
- بنية API RESTful
- مصادقة قائمة على JWT
- التحكم في الوصول القائم على الأدوار (RBAC)
- التحقق الشامل ومعالجة الأخطاء
- توثيق API عبر Swagger

**طبقة قاعدة البيانات (PostgreSQL عبر Supabase):**
- قاعدة بيانات علائقية مع امتثال ACID
- أمان مستوى الصف (RLS) لتعدد المستأجرين
- استعلامات مفهرسة للأداء الأمثل
- النسخ الاحتياطية التلقائية والاستعادة في الوقت المناسب

**التكاملات الخارجية:**
- Supabase لقاعدة البيانات والتخزين
- WhatsApp Business API للرسائل
- معالجة ملفات Excel/CSV
- توليد PDF للتقارير والفواتير

### 2.2 فئات المستخدمين وخصائصهم

يدعم النظام أدوار مستخدمين متعددة بمستويات مختلفة من الوصول والصلاحيات:

#### 2.2.1 المدير
- **الخصائص:** مالك المكتب أو المدير الأول مع الوصول الكامل للنظام
- **الخبرة التقنية:** متوسطة - مألوف مع برامج الأعمال
- **تكرار الاستخدام:** يوميًا، طوال ساعات العمل
- **الصلاحيات:**
  - عمليات CRUD كاملة على جميع الكيانات
  - الوصول إلى التقارير المالية والتحليلات
  - إدارة المستخدمين والموظفين
  - تكوين النظام والإعدادات
  - أذونات الحذف

#### 2.2.2 الموظف
- **الخصائص:** وكلاء عقاريون وموظفو إدارة
- **الخبرة التقنية:** أساسية إلى متوسطة
- **تكرار الاستخدام:** يوميًا، طوال ساعات العمل
- **الصلاحيات:**
  - إدراج وإدارة العقارات
  - تفاعل وتتبع العملاء
  - جدولة المواعيد
  - عرض وتعديل العقود (محدود)
  - عرض التقارير
  - لا يمكن حذف السجلات الحرجة

#### 2.2.3 المحاسب
- **الخصائص:** موظفو الشؤون المالية المسؤولون عن المدفوعات والمحاسبة
- **الخبرة التقنية:** متوسطة
- **تكرار الاستخدام:** يوميًا للمهام المالية
- **الصلاحيات:**
  - تسجيل وتتبع المدفوعات
  - توليد التقارير المالية
  - إنشاء الفواتير
  - لا يمكن تعديل العقارات أو العقود

#### 2.2.4 الفني
- **الخصائص:** موظفو الصيانة الذين يستجيبون لطلبات الخدمة
- **الخبرة التقنية:** أساسية
- **تكرار الاستخدام:** حسب الحاجة لمهام الصيانة
- **الصلاحيات:**
  - عرض وتحديث طلبات الصيانة
  - وضع علامة على الطلبات كمكتملة
  - رفع صور وتقارير الإنجاز
  - وصول محدود لتفاصيل العقار

#### 2.2.5 العميل - مستخدم خارجي
- **الخصائص:** مشترين أو بائعين أو مستأجرين أو مؤجرين
- **الخبرة التقنية:** متنوعة (أساسية إلى متوسطة)
- **تكرار الاستخدام:** عرضي، حسب الحاجة
- **الوصول:**
  - تقديم طلبات الصيانة (للمستأجرين)
  - عرض معلومات العقد (محدود)
  - تلقي الإشعارات والتذكيرات
  - الوصول عبر البوابات العامة

### 2.3 بيئة التشغيل

#### 2.3.1 متطلبات الأجهزة

**بيئة الخادم:**
- **المعالج:** معالج متعدد النوى (2 نواة كحد أدنى، 4+ نواة موصى به)
- **الذاكرة:** 4 جيجابايت كحد أدنى، 8 جيجابايت+ موصى به
- **التخزين:** 20 جيجابايت SSD كحد أدنى، 50 جيجابايت+ موصى به لتخزين الملفات
- **الشبكة:** اتصال إنترنت واسع النطاق (10 ميجابت/ثانية كحد أدنى للتحميل/التنزيل)

**بيئة العميل:**
- **الأجهزة:** أجهزة الكمبيوتر المكتبية، أجهزة الكمبيوتر المحمولة، الأجهزة اللوحية، الهواتف الذكية
- **دقة الشاشة:** 320 بكسل كحد أدنى (الهاتف المحمول) إلى 1920 بكسل+ (سطح المكتب)
- **الإدخال:** لوحة المفاتيح، الماوس/لوحة اللمس، شاشة اللمس

#### 2.3.2 متطلبات البرمجيات

**جانب الخادم:**
- **نظام التشغيل:** Linux (Ubuntu 20.04+ موصى به)، Windows Server، أو macOS
- **بيئة التشغيل:** Node.js v18.x أو أحدث
- **قاعدة البيانات:** PostgreSQL 14+ (تديرها Supabase)
- **مدير العمليات:** PM2 أو مماثل للإنتاج

**جانب العميل:**
- **متصفحات الويب:**
  - Google Chrome 90+
  - Mozilla Firefox 88+
  - Microsoft Edge 90+
  - Safari 14+
  - متصفحات الهاتف المحمول (Chrome، Safari)
- **JavaScript:** مفعّل (مطلوب)
- **ملفات تعريف الارتباط:** مفعّلة للمصادقة

**بيئة التطوير:**
- **Node.js:** v18.x أو أحدث
- **مدير الحزم:** npm أو yarn
- **IDE:** Visual Studio Code، WebStorm، أو مماثل
- **Git:** للتحكم في الإصدار

### 2.4 قيود التصميم والتنفيذ

#### 2.4.1 القيود التقنية

1. **مجموعة التقنيات:**
   - يجب استخدام TypeScript لسلامة الأنواع
   - يجب بناء الواجهة الأمامية باستخدام Next.js 14
   - يجب أن تستخدم الخلفية إطار عمل NestJS
   - يجب أن تكون قاعدة البيانات PostgreSQL

2. **الأداء:**
   - يجب ألا يتجاوز وقت استجابة API ثانيتين لـ 95٪ من الطلبات
   - يجب أن يكون وقت تحميل الصفحة الأمامية أقل من 3 ثوانٍ
   - يجب أن يتعامل النظام مع 100 مستخدم متزامن على الأقل

3. **الأمان:**
   - يجب أن تستخدم جميع اتصالات API بروتوكول HTTPS
   - يجب تشفير كلمات المرور باستخدام bcrypt أو مماثل
   - يجب أن تنتهي رموز JWT بعد فترة قابلة للتكوين
   - يجب تنفيذ حماية CORS
   - منع حقن SQL من خلال ORM

4. **تخزين البيانات:**
   - يجب تخزين الملفات مع التحكم في الوصول
   - الحد الأقصى لحجم تحميل الملف: 10 ميجابايت لكل ملف
   - صيغ الصور المدعومة: JPEG، PNG، WebP
   - صيغ المستندات المدعومة: PDF، Excel، CSV

#### 2.4.2 قواعد العمل

1. **تعدد المستأجرين:**
   - يعمل كل مكتب في بيئة معزولة
   - لا يوجد وصول للبيانات عبر المكاتب
   - العلامة التجارية والتكوين الخاصة بالمكتب

2. **سلامة البيانات:**
   - أرقام هواتف فريدة لكل مكتب
   - يجب أن تكون رموز العقارات فريدة داخل المكتب
   - لا يمكن حذف السجلات ذات التبعيات النشطة
   - حذف ناعم لمعظم الكيانات (سجل التدقيق)

3. **المواعيد:**
   - لا توجد مواعيد متداخلة لنفس عضو الفريق
   - الحد الأدنى للمدة 30 دقيقة
   - يجب أن تكون ضمن ساعات العمل (قابلة للتكوين)

4. **المدفوعات:**
   - يجب أن تتطابق مبالغ الدفع مع شروط العقد
   - لا يمكن وضع علامة على المدفوعات المتأخرة كمستقبلية
   - يتطلب الموافقة على المعاملات الكبيرة

#### 2.4.3 القيود التنظيمية

1. **خصوصية البيانات:**
   - الامتثال لقوانين حماية البيانات المحلية
   - موافقة المستخدم على معالجة البيانات
   - الحق في حذف البيانات (متطلبات شبيهة بـ GDPR)
   - التعامل الآمن مع المعلومات الشخصية

2. **المالية:**
   - حفظ السجلات المالية بدقة
   - سجل التدقيق لجميع المعاملات
   - الامتثال لحساب الضرائب (ضريبة القيمة المضافة السعودية 15٪)

---

## 3. مميزات النظام

### 3.1 المصادقة والتفويض

#### 3.1.1 الوصف

يوفر نظام المصادقة والتفويض التحكم الآمن في الوصول إلى المنصة. يدير هويات المستخدمين، ويتحقق من بيانات الاعتماد، ويحافظ على الجلسات، ويفرض الأذونات القائمة على الأدوار في جميع أنحاء التطبيق.

#### 3.1.2 المتطلبات الوظيفية

**REQ-AUTH-001: تسجيل الدخول**
- **الأولوية:** حرجة
- **الوصف:** يجب أن يكون المستخدمون قادرين على تسجيل الدخول باستخدام بيانات الاعتماد
- **المدخلات:** البريد الإلكتروني/اسم المستخدم وكلمة المرور
- **المعالجة:**
  - التحقق من بيانات الاعتماد مقابل قاعدة البيانات
  - توليد رمز JWT مع معلومات المستخدم
  - تعيين وقت انتهاء الرمز
  - تسجيل محاولة تسجيل الدخول
- **المخرجات:** رمز المصادقة، بيانات ملف المستخدم
- **معالجة الأخطاء:** بيانات اعتماد غير صالحة تعيد رسالة خطأ

**REQ-AUTH-002: المصادقة القائمة على الرمز**
- **الأولوية:** حرجة
- **الوصف:** يجب أن تتضمن جميع طلبات API المحمية رمز JWT صالح
- **المعالجة:**
  - التحقق من توقيع الرمز
  - فحص انتهاء صلاحية الرمز
  - استخراج معلومات المستخدم والمكتب
  - التحقق من أن المستخدم غير محظور
- **معالجة الأخطاء:** إرجاع 401 Unauthorized للرموز غير الصالحة

**REQ-AUTH-003: التحكم في الوصول القائم على الأدوار**
- **الأولوية:** حرجة
- **الوصف:** يجب أن يفرض النظام الأذونات القائمة على الأدوار
- **الأدوار:** مدير، موظف، محاسب، فني
- **المعالجة:**
  - التحقق من دور المستخدم من رمز JWT
  - التحقق من أن الدور لديه إذن للعملية المطلوبة
  - تطبيق فلاتر البيانات الخاصة بالدور
- **معالجة الأخطاء:** إرجاع 403 Forbidden لأذونات غير كافية

**REQ-AUTH-004: إدارة الجلسة**
- **الأولوية:** عالية
- **الوصف:** يجب أن يدير النظام جلسات المستخدم النشطة
- **الميزات:**
  - آلية تحديث الرمز
  - تسجيل خروج تلقائي بعد عدم النشاط
  - دعم جلسة متعددة الأجهزة
  - وظيفة تسجيل الخروج اليدوي

**REQ-AUTH-005: أمان كلمة المرور**
- **الأولوية:** حرجة
- **الوصف:** يجب تخزين وإدارة كلمات المرور بشكل آمن
- **المتطلبات:**
  - تشفير كلمات المرور باستخدام bcrypt (10+ جولات)
  - الحد الأدنى لطول كلمة المرور: 8 أحرف
  - إعادة تعيين كلمة المرور عبر البريد الإلكتروني
  - وظيفة تغيير كلمة المرور

#### 3.1.3 حالات الاستخدام

**حالة استخدام: تسجيل الدخول**
```
الفاعل: موظف
الشروط المسبقة: المستخدم لديه بيانات اعتماد صالحة
التدفق الرئيسي:
  1. ينتقل المستخدم إلى صفحة تسجيل الدخول
  2. يدخل المستخدم البريد الإلكتروني وكلمة المرور
  3. يتحقق النظام من بيانات الاعتماد
  4. يولد النظام رمز JWT
  5. يعيد النظام التوجيه إلى لوحة المعلومات
  6. تم تسجيل دخول المستخدم بنجاح
التدفق البديل:
  3a. بيانات اعتماد غير صالحة
      - يعرض النظام رسالة خطأ
      - يمكن للمستخدم إعادة المحاولة
الشروط اللاحقة: تمت مصادقة المستخدم ويمكنه الوصول إلى الموارد المحمية
```

### 3.2 إدارة العقارات

#### 3.2.1 الوصف

يمكّن وحدة إدارة العقارات المكاتب العقارية من إدارة مخزون العقارات الخاص بها، بما في ذلك العقارات السكنية والتجارية والأراضي. توفر عمليات CRUD شاملة، وبحث وتصفية متقدمة، وإدارة الوسائط، وعمليات مجمعة من خلال استيراد/تصدير Excel.

#### 3.2.2 المتطلبات الوظيفية

**REQ-PROP-001: قائمة العقارات**
- **الأولوية:** حرجة
- **الوصف:** عرض قائمة مقسّمة للعقارات مع الفلاتر
- **الميزات:**
  - أوضاع عرض الشبكة والقائمة
  - أعمدة قابلة للفرز
  - البحث السريع حسب العنوان أو الكود أو الموقع
  - فلاتر متقدمة (النوع، الحالة، نطاق السعر، المدينة)
  - الترقيم مع حجم صفحة قابل للتكوين
- **الأداء:** التحميل خلال ثانيتين لما يصل إلى 1000 عقار

**REQ-PROP-002: إنشاء عقار**
- **الأولوية:** حرجة
- **الوصف:** السماح للمستخدمين المصرح لهم بإضافة عقارات جديدة
- **الحقول المطلوبة:**
  - رمز العقار (فريد لكل مكتب)
  - العنوان (عربي وإنجليزي)
  - نوع العقار (شقة، فيلا، أرض، تجاري، إلخ)
  - نوع الإدراج (بيع، إيجار)
  - السعر والعملة
  - المساحة (متر مربع)
  - الموقع (المدينة، الحي، العنوان)
  - عدد الغرف، الحمامات
  - الحالة (متاح، مؤجر، مباع، تحت الصيانة)
- **الحقول الاختيارية:**
  - الوصف
  - الميزات (موقف سيارات، مسبح، حديقة، إلخ)
  - سنة البناء
  - معلومات المالك
  - حقول مخصصة
- **التحقق:**
  - يجب توفير جميع الحقول المطلوبة
  - يجب أن يكون السعر رقمًا موجبًا
  - يجب أن تكون المساحة رقمًا موجبًا
  - يجب أن يكون رمز العقار فريدًا
  - يجب أن تتبع أرقام الهواتف التنسيق

**REQ-PROP-003: تحديث عقار**
- **الأولوية:** عالية
- **الوصف:** تعديل معلومات العقار الحالية
- **المعالجة:**
  - التحقق من الملكية (نفس المكتب)
  - تطبيق الأذونات القائمة على الأدوار
  - تتبع التغييرات في سجل التدقيق
  - تحديث الطابع الزمني للتعديل
- **القيود:** لا يمكن تغيير رمز العقار بعد الإنشاء

**REQ-PROP-004: حذف عقار**
- **الأولوية:** متوسطة
- **الوصف:** حذف ناعم للعقارات من النظام
- **الوصول:** دور المدير فقط
- **المعالجة:**
  - التحقق من العقود النشطة
  - التحقق من المواعيد المجدولة
  - تنفيذ الحذف الناعم (وضع علامة كمحذوف)
  - الحفاظ على البيانات لسجل التدقيق
- **معالجة الأخطاء:** منع الحذف إذا كانت هناك تبعيات نشطة

**REQ-PROP-005: إدارة وسائط العقار**
- **الأولوية:** عالية
- **الوصف:** إدارة صور ومستندات العقار
- **الميزات:**
  - رفع صور متعددة (حتى 20 لكل عقار)
  - تعيين صورة أساسية/مميزة
  - إعادة ترتيب بالسحب والإفلات
  - تحسين وضغط الصورة
  - تسمية توضيحية ونص بديل للصور
  - رفع مستندات PDF (مخططات طوابق، عقود)
- **متطلبات الملف:**
  - صيغ الصورة: JPEG، PNG، WebP
  - الحد الأقصى للحجم: 10 ميجابايت لكل ملف
  - تغيير الحجم التلقائي للأبعاد القياسية
  - توليد صور مصغرة

**REQ-PROP-006: عرض تفاصيل العقار**
- **الأولوية:** عالية
- **الوصف:** عرض معلومات شاملة عن العقار
- **الأقسام:**
  - نظرة عامة على العقار
  - معرض الصور مع صندوق الضوء
  - تكامل خريطة الموقع
  - الميزات ووسائل الراحة
  - المعلومات المالية
  - العقود ذات الصلة
  - سجل المشاهدة
  - تتبع اهتمام العميل

**REQ-PROP-007: بحث وفلاتر العقارات**
- **الأولوية:** عالية
- **الوصف:** قدرات بحث وتصفية متقدمة
- **معايير البحث:**
  - بحث نصي (العنوان، الوصف، الكود)
  - نوع العقار
  - نوع الإدراج (بيع/إيجار)
  - نطاق السعر (الأدنى-الأقصى)
  - نطاق المساحة (الأدنى-الأقصى)
  - عدد غرف النوم
  - عدد الحمامات
  - المدينة والحي
  - الحالة (متاح، مؤجر، مباع)
  - الميزات (موقف سيارات، مسبح، حديقة)
  - تاريخ الإضافة
- **الميزات:**
  - نتائج بحث في الوقت الفعلي
  - اقتراحات البحث
  - حفظ معايير البحث
  - خيار مسح جميع الفلاتر

#### 3.2.3 نموذج البيانات

**كيان العقار:**
```typescript
interface Property {
  id: UUID
  office_id: UUID
  property_code: string (unique)
  property_type: enum ('apartment', 'villa', 'land', 'commercial', 'duplex', 'townhouse', 'penthouse', 'studio', 'chalet', 'farm')
  listing_type: enum ('sale', 'rent')
  status: enum ('available', 'rented', 'sold', 'reserved', 'under_maintenance', 'draft')
  title: string
  title_en?: string
  description?: text
  description_en?: text
  price: decimal
  currency: string (default: 'SAR')
  area: decimal (square meters)
  city: string
  district?: string
  address: text
  location?: point (latitude, longitude)
  bedrooms: integer
  bathrooms: integer
  features?: jsonb (parking, pool, garden, elevator, security, gym, etc.)
  year_built?: integer
  floor_number?: integer
  owner_name?: string
  owner_phone?: string
  is_featured: boolean
  view_count: integer
  created_by: UUID
  assigned_agent?: UUID
  created_at: timestamp
  updated_at: timestamp
  deleted_at?: timestamp
}
```

### 3.3 إدارة علاقات العملاء (CRM)

#### 3.3.1 الوصف

تدير وحدة CRM جميع المعلومات والتفاعلات المتعلقة بالعملاء. تتبع المشترين المحتملين والبائعين والمستأجرين والمؤجرين، مع الحفاظ على ملفات تعريف مفصلة وتاريخ التفاعل واهتمامات العقارات وتفضيلات الاتصال.

#### 3.3.2 المتطلبات الوظيفية

**REQ-CRM-001: إدارة ملف العميل**
- **الأولوية:** حرجة
- **الوصف:** إنشاء وصيانة ملفات شاملة للعملاء
- **الحقول المطلوبة:**
  - الاسم
  - رقم الهاتف (فريد لكل مكتب)
  - نوع العميل (مشتري، بائع، مستأجر، مؤجر، كليهما)
  - الحالة (نشط، غير نشط، محظور)
- **الحقول الاختيارية:**
  - عنوان البريد الإلكتروني
  - الهوية الوطنية
  - المدينة والعنوان
  - طريقة الاتصال المفضلة (هاتف، بريد إلكتروني، واتساب)
  - نطاق الميزانية
  - أنواع العقارات المفضلة
  - المواقع المفضلة
  - التقييم (1-5 نجوم)
  - المصدر (موقع الويب، إحالة، زيارة، وسائل التواصل الاجتماعي)
  - ملاحظات
  - علامات مخصصة
- **التحقق:**
  - التحقق من صحة تنسيق رقم الهاتف
  - التحقق من صحة تنسيق البريد الإلكتروني
  - رقم هاتف فريد لكل مكتب
  - يجب توفير الحقول المطلوبة

**REQ-CRM-002: تتبع تفاعلات العميل**
- **الأولوية:** عالية
- **الوصف:** تسجيل جميع تفاعلات واتصالات العملاء
- **أنواع التفاعل:**
  - المكالمات الهاتفية
  - الاجتماعات
  - المراسلات الإلكترونية
  - رسائل واتساب
  - مشاهدات العقارات
- **المعلومات المتتبعة:**
  - نوع التفاعل
  - التاريخ والوقت
  - الوصف/الملخص
  - العقار ذو الصلة (إن وجد)
  - عضو الفريق المعني
  - النتيجة/النتيجة
  - تاريخ المتابعة التالي
- **الميزات:**
  - عرض الجدول الزمني لجميع التفاعلات
  - الفلترة حسب النوع والتاريخ
  - تذكيرات آلية للمتابعة
  - تصدير سجل التفاعل

**REQ-CRM-003: ملاحظات العميل**
- **الأولوية:** متوسطة
- **الوصف:** إضافة وإدارة الملاحظات الداخلية حول العملاء
- **الميزات:**
  - ملاحظات نصية غنية
  - وضع علامة على الملاحظات كمهمة
  - وسم الملاحظات حسب الفئة
  - تتبع مؤلف الملاحظة والطابع الزمني
  - البحث داخل الملاحظات
  - تعديل وحذف الملاحظات

**REQ-CRM-004: تتبع اهتمام العقارات**
- **الأولوية:** عالية
- **الوصف:** تتبع اهتمام العملاء بالعقارات
- **أنواع العلاقة:**
  - المالك (يملك العقار)
  - مهتم (أبدى اهتمامًا)
  - تمت المشاهدة (حضر المشاهدة)
  - يتفاوض (في مرحلة التفاوض)
  - متعاقد (وقّع عقدًا)
- **الميزات:**
  - ربط العملاء بالعقارات
  - تتبع سجل المشاهدة
  - تسجيل مستوى الاهتمام
  - مراقبة حالة التفاوض
  - عرض محفظة العقارات الخاصة بالعميل

**REQ-CRM-005: بحث وفلترة العملاء**
- **الأولوية:** عالية
- **الوصف:** البحث والفلترة في قاعدة بيانات العملاء
- **معايير البحث:**
  - الاسم أو الهاتف أو البريد الإلكتروني
  - نوع العميل
  - الحالة
  - المدينة
  - المصدر
  - التقييم
  - عضو الفريق المخصص
  - نطاق التاريخ
- **الميزات:**
  - شريط بحث سريع
  - لوحة فلتر متقدمة
  - حفظ مجموعات الفلاتر
  - تصدير النتائج المفلترة

**REQ-CRM-006: إحصائيات العملاء**
- **الأولوية:** متوسطة
- **الوصف:** عرض مقاييس العملاء الرئيسية
- **المقاييس:**
  - إجمالي العملاء
  - العملاء حسب النوع (مشترون، بائعون، إلخ)
  - العملاء حسب الحالة (نشط، غير نشط)
  - عملاء جدد هذا الشهر
  - إجمالي الإنفاق حسب العميل
  - إجمالي الإيرادات من العميل
  - الرصيد المستحق
  - متوسط التقييم

**REQ-CRM-007: استيراد/تصدير العملاء**
- **الأولوية:** متوسطة
- **الوصف:** استيراد وتصدير بيانات العملاء بالجملة
- **الميزات:**
  - الاستيراد من Excel/CSV
  - أداة تعيين الأعمدة
  - التحقق قبل الاستيراد
  - اكتشاف التكرار
  - التصدير إلى Excel/CSV/PDF
  - اختيار أعمدة مخصصة
  - الفلترة قبل التصدير

#### 3.3.3 نموذج البيانات

**كيان العميل:**
```typescript
interface Customer {
  id: UUID
  office_id: UUID
  name: string
  phone: string (unique per office)
  email?: string
  national_id?: string
  type: enum ('buyer', 'seller', 'renter', 'landlord', 'both')
  status: enum ('active', 'inactive', 'blocked')
  city?: string
  address?: text
  preferred_contact_method?: enum ('phone', 'email', 'whatsapp')
  source?: string (website, referral, walk-in, social_media, etc.)
  rating?: integer (1-5)
  notes?: text
  tags?: jsonb
  total_spent: decimal (default: 0)
  total_earned: decimal (default: 0)
  outstanding_balance: decimal (default: 0)
  assigned_staff_id?: UUID
  last_contact_date?: timestamp
  created_at: timestamp
  updated_at: timestamp
}
```

### 3.4 إدارة المواعيد

#### 3.4.1 الوصف

تتعامل وحدة إدارة المواعيد مع جدولة وتتبع جميع المواعيد المتعلقة بالعقارات، بما في ذلك المشاهدات والاجتماعات والتوقيعات والتفتيش. توفر اكتشاف التعارضات والتذكيرات وتكامل التقويم.

#### 3.4.2 المتطلبات الوظيفية

**REQ-APPT-001: جدولة الموعد**
- **الأولوية:** حرجة
- **الوصف:** إنشاء وجدولة المواعيد
- **الحقول المطلوبة:**
  - العنوان
  - النوع (مشاهدة، اجتماع، توقيع، تفتيش، استشارة، أخرى)
  - التاريخ
  - وقت البدء
  - وقت الانتهاء
  - عضو الفريق المخصص
- **الحقول الاختيارية:**
  - الوصف
  - العقار (إن وجد)
  - العميل (إن وجد)
  - الموقع/العنوان
  - رابط الاجتماع (للاجتماعات الافتراضية)
  - ملاحظات
- **التحقق:**
  - يجب أن يكون وقت الانتهاء بعد وقت البدء
  - الحد الأدنى للمدة: 30 دقيقة
  - يجب ألا يكون التاريخ في الماضي
  - يجب أن يكون عضو الفريق متاحًا (لا يوجد تعارض)

**REQ-APPT-002: اكتشاف التعارضات**
- **الأولوية:** عالية
- **الوصف:** منع تعارضات الجدولة
- **المعالجة:**
  - التحقق من المواعيد المتداخلة
  - التحقق من جدول عضو الفريق
  - النظر في وقت السفر بين المواقع
  - احترام ساعات العمل
- **الإجراءات:**
  - عرض تحذير إذا تم اكتشاف تعارض
  - اقتراح أوقات بديلة
  - السماح بالتجاوز للمديرين (مع تحذير)

**REQ-APPT-003: إدارة حالة الموعد**
- **الأولوية:** عالية
- **الوصف:** تتبع دورة حياة الموعد
- **الحالات:**
  - مجدول (الحالة الأولية)
  - مؤكد (تأكيد العميل)
  - قيد التقدم (بدأ الموعد)
  - مكتمل (انتهى بنجاح)
  - ملغى (ألغاه أي من الطرفين)
  - لم يحضر (لم يحضر العميل)
- **انتقالات الحالة:**
  - تسجيل من قام بتغيير الحالة
  - تسجيل الطابع الزمني للتغيير
  - اشتراط ملاحظات اختياريًا للإلغاء
  - تتبع ملاحظات الإنجاز

**REQ-APPT-004: عرض التقويم**
- **الأولوية:** عالية
- **الوصف:** عرض المواعيد بتنسيق التقويم
- **العروض:**
  - عرض الشهر
  - عرض الأسبوع
  - عرض اليوم
  - عرض القائمة
- **الميزات:**
  - ترميز لوني حسب النوع
  - الفلترة حسب عضو الفريق
  - الفلترة حسب العقار
  - الفلترة حسب العميل
  - الفلترة حسب الحالة
  - إعادة الجدولة بالسحب والإفلات (مع التحقق)
  - انقر لعرض/تعديل التفاصيل

**REQ-APPT-005: تذكيرات الموعد**
- **الأولوية:** متوسطة
- **الوصف:** إرسال تذكيرات آلية
- **أنواع التذكير:**
  - إشعارات البريد الإلكتروني
  - رسائل SMS
  - رسائل واتساب
  - إشعارات داخل التطبيق
- **التوقيت:**
  - فترات تذكير قابلة للتكوين (قبل 24 ساعة، قبل ساعة واحدة، إلخ)
  - تذكيرات متعددة لكل موعد
  - تذكيرات الموظفين والعملاء
- **المحتوى:**
  - تفاصيل الموعد
  - معلومات العقار
  - معلومات الاتصال بعضو الفريق
  - الموقع/التوجيهات
  - روابط التأكيد/الإلغاء

**REQ-APPT-006: إنجاز الموعد**
- **الأولوية:** متوسطة
- **الوصف:** تسجيل نتائج الموعد
- **الحقول:**
  - ملاحظات الإنجاز
  - ملاحظات العميل
  - الخطوات التالية
  - تاريخ المتابعة
  - النتيجة (ناجح، غير ناجح، يحتاج_متابعة)
- **الإجراءات:**
  - تسجيل التفاعل في CRM
  - إنشاء مهمة متابعة
  - تحديث عدد مشاهدات العقار
  - تشغيل سير عمل آلي

**REQ-APPT-007: إحصائيات المواعيد**
- **الأولوية:** منخفضة
- **الوصف:** عرض مقاييس المواعيد
- **المقاييس:**
  - إجمالي المواعيد
  - المواعيد حسب النوع
  - المواعيد حسب الحالة
  - مواعيد اليوم
  - المواعيد القادمة
  - معدل الإنجاز
  - معدل عدم الحضور
  - متوسط المدة

#### 3.4.3 نموذج البيانات

**كيان الموعد:**
```typescript
interface Appointment {
  id: UUID
  office_id: UUID
  title: string
  description?: text
  type: enum ('viewing', 'meeting', 'signing', 'inspection', 'consultation', 'other')
  status: enum ('scheduled', 'confirmed', 'in_progress', 'completed', 'cancelled', 'no_show')
  date: date
  start_time: time
  end_time: time
  duration: integer (minutes)
  property_id?: UUID
  customer_id?: UUID
  assigned_staff_id: UUID
  location?: text
  meeting_link?: string
  notes?: text
  completion_notes?: text
  created_by: UUID
  cancelled_by?: UUID
  cancelled_at?: timestamp
  cancellation_reason?: text
  created_at: timestamp
  updated_at: timestamp
}
```

### 3.5 إدارة العقود

#### 3.5.1 الوصف

تتعامل وحدة إدارة العقود مع اتفاقيات الإيجار والبيع، وتتبع دورة حياة العقد وجداول الدفع والتجديدات والإنهاءات. توفر تتبعًا شاملاً للعقود ومراقبة مالية.

#### 3.5.2 المتطلبات الوظيفية

**REQ-CONT-001: إنشاء عقد**
- **الأولوية:** حرجة
- **الوصف:** إنشاء عقود إيجار أو بيع جديدة
- **الحقول المطلوبة:**
  - رقم العقد (يتم إنشاؤه تلقائيًا: CON-YYYY-XXXX)
  - نوع العقد (إيجار، بيع، صيانة)
  - العقار
  - العميل (العملاء)
  - تاريخ البدء
  - تاريخ الانتهاء (لعقود الإيجار)
  - القيمة الإجمالية
  - شروط الدفع
- **الحقول الاختيارية:**
  - مبلغ التأمين
  - مبلغ العمولة
  - جدول الدفع
  - الشروط والأحكام
  - البنود الخاصة
  - المستندات المرفقة
- **التحقق:**
  - يجب أن يكون العقار متاحًا
  - يجب أن يكون تاريخ الانتهاء بعد تاريخ البدء
  - يجب أن تكون القيمة الإجمالية موجبة
  - يجب أن يتطابق جدول الدفع مع القيمة الإجمالية

**REQ-CONT-002: تتبع حالة العقد**
- **الأولوية:** عالية
- **الوصف:** تتبع حالات دورة حياة العقد
- **الحالات:**
  - مسودة (قيد الإعداد)
  - نشط (صالح حاليًا)
  - منتهي (تجاوز تاريخ الانتهاء)
  - ملغى (أنهى مبكرًا)
  - معلق (متوقف مؤقتًا)
- **تحديثات الحالة التلقائية:**
  - وضع علامة كمنتهي عند مرور تاريخ الانتهاء
  - تنبيه عند الاقتراب من الانتهاء (30 يومًا)
  - تتبع حالة الدفع
  - حساب الأيام المتبقية

**REQ-CONT-003: إدارة جدول الدفع**
- **الأولوية:** عالية
- **الوصف:** إدارة أقساط الدفع للعقد
- **الميزات:**
  - إنشاء جدول الدفع
  - تتبع الأقساط المدفوعة مقابل غير المدفوعة
  - تسجيل المدفوعات الجزئية
  - حساب الرصيد المستحق
  - تواريخ استحقاق الدفع
  - تتبع المدفوعات المتأخرة
- **طرق الدفع:**
  - نقدي
  - تحويل بنكي
  - شيك
  - بطاقة ائتمان
  - دفع عبر الإنترنت

**REQ-CONT-004: تجديد العقد**
- **الأولوية:** متوسطة
- **الوصف:** التعامل مع عملية تجديد العقد
- **الميزات:**
  - تنبيهات التجديد قبل الانتهاء
  - توليد عقد تجديد من الموجود
  - تحديث الشروط (السعر، المدة)
  - تتبع سجل التجديد
  - الربط بالعقد السابق
- **المعالجة:**
  - نسخ تفاصيل العقد
  - تحديث التواريخ والمبالغ
  - إعادة تعيين جدول الدفع
  - الحفاظ على العلاقة بالأصل

**REQ-CONT-005: إنهاء العقد**
- **الأولوية:** متوسطة
- **الوصف:** معالجة الإنهاء المبكر للعقد
- **المعلومات المطلوبة:**
  - تاريخ الإنهاء
  - سبب الإنهاء
  - مبلغ التسوية النهائية
  - رسوم الغرامة (إن وجدت)
- **المعالجة:**
  - حساب المدفوعات المستحقة
  - تطبيق غرامات الإنهاء
  - توليد فاتورة نهائية
  - تحديث حالة العقار
  - تسجيل الإنهاء في السجل

**REQ-CONT-006: مستندات العقد**
- **الأولوية:** متوسطة
- **الوصف:** إدارة المستندات المتعلقة بالعقد
- **أنواع المستندات:**
  - عقد PDF موقع
  - الملاحق
  - إيصالات الدفع
  - المراسلات
  - نسخ الهوية
  - مستندات العقار
- **الميزات:**
  - رفع مستندات متعددة
  - التحكم في الإصدار
  - التنزيل والطباعة
  - توليد عقد من قالب

**REQ-CONT-007: تقارير العقود**
- **الأولوية:** متوسطة
- **الوصف:** توليد تقارير متعلقة بالعقود
- **التقارير:**
  - قائمة العقود النشطة
  - العقود المنتهية (التالية 30/60/90 يومًا)
  - ملخص إيرادات العقود
  - تقرير حالة الدفع
  - المدفوعات المتأخرة
  - ملخص العمولة
- **صيغ التصدير:** Excel، PDF، CSV

#### 3.5.3 نموذج البيانات

**كيان العقد:**
```typescript
interface Contract {
  id: UUID
  office_id: UUID
  contract_number: string (unique)
  contract_type: enum ('rent', 'sale', 'maintenance')
  status: enum ('draft', 'active', 'expired', 'cancelled', 'suspended')
  property_id: UUID
  customer_id: UUID
  landlord_id?: UUID
  start_date: date
  end_date?: date
  total_value: decimal
  currency: string
  deposit_amount?: decimal
  commission_amount?: decimal
  commission_percentage?: decimal
  payment_frequency?: enum ('monthly', 'quarterly', 'yearly', 'one_time')
  payment_terms?: text
  terms_and_conditions?: text
  special_clauses?: text
  created_by: UUID
  cancelled_at?: timestamp
  cancellation_reason?: text
  created_at: timestamp
  updated_at: timestamp
}
```

(يتبع... - بقية المحتوى كبير جدًا)

---

**ملحوظة:** هذه الوثيقة تحتوي على وصف شامل لجميع متطلبات نظام إدارة العقارات بما في ذلك:
- إدارة المدفوعات
- إدارة الصيانة
- التقارير المالية والتحليلات
- نظام استيراد/تصدير Excel
- تكامل واتساب
- لوحة التحليلات
- متطلبات الواجهات الخارجية
- المتطلبات غير الوظيفية

تم تقديم النسخة الكاملة باللغة الإنجليزية في ملف `SRS_English.md`.

---

**نهاية مواصفات متطلبات البرمجيات**
