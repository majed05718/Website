# خطة تنفيذ التغييرات (CIP)

- **تاريخ التوليد**: 2025-11-09 19:56 UTC
- **الهدف**: تقديم خطوات عملية قابلة للتتبع لتعديل الوحدات أو توسيعها مع الحفاظ على سلامة النظام.

## التحليلات

### خطة لـ `AnalyticsController.dashboard` (Get /analytics/dashboard)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/analytics/analytics.controller.ts` الأسطر 16-19.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AnalyticsController.properties` (Get /analytics/properties)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/analytics/analytics.controller.ts` الأسطر 22-25.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AnalyticsController.financials` (Get /analytics/financials)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/analytics/analytics.controller.ts` الأسطر 29-32.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AnalyticsController.kpis` (Get /analytics/kpis)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/analytics/analytics.controller.ts` الأسطر 36-39.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AnalyticsController.staffPerf` (Get /analytics/staff-performance)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/analytics/analytics.controller.ts` الأسطر 43-46.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

---

## app

---

## المواعيد

### خطة لـ `AppointmentsController.findAll` (Get /appointments)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/appointments/appointments.controller.ts` الأسطر 23-27.
   - تحديد كائنات DTO المرتبطة: FilterAppointmentsDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AppointmentsController.getStats` (Get /appointments/stats)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/appointments/appointments.controller.ts` الأسطر 31-35.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AppointmentsController.getToday` (Get /appointments/today)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/appointments/appointments.controller.ts` الأسطر 53-57.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AppointmentsController.getUpcoming` (Get /appointments/upcoming)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/appointments/appointments.controller.ts` الأسطر 62-66.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AppointmentsController.findOne` (Get /appointments/:id)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/appointments/appointments.controller.ts` الأسطر 70-74.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AppointmentsController.create` (Post /appointments)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/appointments/appointments.controller.ts` الأسطر 79-85.
   - تحديد كائنات DTO المرتبطة: CreateAppointmentDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AppointmentsController.update` (Patch /appointments/:id)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/appointments/appointments.controller.ts` الأسطر 90-95.
   - تحديد كائنات DTO المرتبطة: UpdateAppointmentDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AppointmentsController.remove` (Delete /appointments/:id)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/appointments/appointments.controller.ts` الأسطر 100-104.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AppointmentsController.updateStatus` (Patch /appointments/:id/status)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/appointments/appointments.controller.ts` الأسطر 109-115.
   - تحديد كائنات DTO المرتبطة: UpdateStatusDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AppointmentsController.cancel` (Patch /appointments/:id/cancel)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/appointments/appointments.controller.ts` الأسطر 120-126.
   - تحديد كائنات DTO المرتبطة: CancelAppointmentDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AppointmentsController.complete` (Patch /appointments/:id/complete)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/appointments/appointments.controller.ts` الأسطر 131-136.
   - تحديد كائنات DTO المرتبطة: CompleteAppointmentDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AppointmentsController.sendReminder` (Post /appointments/:id/remind)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/appointments/appointments.controller.ts` الأسطر 141-145.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `AppointmentsController.checkAvailability` (Post /appointments/check-availability)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/appointments/appointments.controller.ts` الأسطر 150-154.
   - تحديد كائنات DTO المرتبطة: CheckAvailabilityDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

---

## components

---

## العملاء

### خطة لـ `CustomersController.findAll` (Get /customers)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/customers.controller.ts` الأسطر 25-29.
   - تحديد كائنات DTO المرتبطة: FilterCustomersDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `CustomersController.getStats` (Get /customers/stats)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/customers.controller.ts` الأسطر 33-37.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `CustomersController.search` (Get /customers/search)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/customers.controller.ts` الأسطر 42-46.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `CustomersController.exportExcel` (Get /customers/export)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/customers.controller.ts` الأسطر 51-83.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `CustomersController.findOne` (Get /customers/:id)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/customers.controller.ts` الأسطر 87-91.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `CustomersController.create` (Post /customers)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/customers.controller.ts` الأسطر 96-102.
   - تحديد كائنات DTO المرتبطة: CreateCustomerDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `CustomersController.update` (Patch /customers/:id)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/customers.controller.ts` الأسطر 107-112.
   - تحديد كائنات DTO المرتبطة: UpdateCustomerDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `CustomersController.remove` (Delete /customers/:id)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/customers.controller.ts` الأسطر 117-121.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `CustomersController.getNotes` (Get /customers/:id/notes)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/customers.controller.ts` الأسطر 126-130.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `CustomersController.createNote` (Post /customers/:id/notes)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/customers.controller.ts` الأسطر 135-141.
   - تحديد كائنات DTO المرتبطة: CreateCustomerNoteDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `CustomersController.removeNote` (Delete /customers/:id/notes/:noteId)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/customers.controller.ts` الأسطر 161-165.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `CustomersController.getInteractions` (Get /customers/:id/interactions)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/customers.controller.ts` الأسطر 170-174.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `CustomersController.linkProperty` (Post /customers/:id/properties)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/customers.controller.ts` الأسطر 195-200.
   - تحديد كائنات DTO المرتبطة: LinkPropertyDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `ExcelController.getTemplates` (Get /customers/excel/templates)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/excel.controller.ts` الأسطر 216-231.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `ExcelController.validateFile` (Post /customers/excel/validate-file)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/excel.controller.ts` الأسطر 329-363.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `ExcelController.getImportStats` (Get /customers/excel/import-stats)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/customers/excel.controller.ts` الأسطر 374-390.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

---

## الصحة

---

## التكاملات

---

## الصيانة

### خطة لـ `MaintenanceController.list` (Get /maintenance)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/maintenance/maintenance.controller.ts` الأسطر 21-24.
   - تحديد كائنات DTO المرتبطة: FilterMaintenanceDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `MaintenanceController.getOne` (Get /maintenance/:id)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/maintenance/maintenance.controller.ts` الأسطر 27-30.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `MaintenanceController.create` (Post /maintenance)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/maintenance/maintenance.controller.ts` الأسطر 34-40.
   - تحديد كائنات DTO المرتبطة: CreateMaintenanceDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `MaintenanceController.createPublic` (Post /public/maintenance)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/maintenance/maintenance.controller.ts` الأسطر 43-48.
   - تحديد كائنات DTO المرتبطة: PublicCreateMaintenanceDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `MaintenanceController.update` (Patch /maintenance/:id)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/maintenance/maintenance.controller.ts` الأسطر 52-56.
   - تحديد كائنات DTO المرتبطة: UpdateMaintenanceDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `MaintenanceController.complete` (Post /maintenance/:id/complete)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/maintenance/maintenance.controller.ts` الأسطر 60-64.
   - تحديد كائنات DTO المرتبطة: CompleteMaintenanceDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

---

## التهيئة

### خطة لـ `OnboardingController.createOffice` (Post /onboarding/office)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/onboarding/onboarding.controller.ts` الأسطر 11-13.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `OnboardingController.verify` (Get /onboarding/verify-code)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/onboarding/onboarding.controller.ts` الأسطر 16-20.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `OnboardingController.complete` (Post /onboarding/complete)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/onboarding/onboarding.controller.ts` الأسطر 23-25.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

---

## المدفوعات

### خطة لـ `PaymentsController.list` (Get /payments)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/payments/payments.controller.ts` الأسطر 18-21.
   - تحديد كائنات DTO المرتبطة: FilterPaymentsDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `PaymentsController.byContract` (Get /contracts/:contractId/payments)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/payments/payments.controller.ts` الأسطر 24-27.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `PaymentsController.markPaid` (Patch /payments/:id/mark-paid)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/payments/payments.controller.ts` الأسطر 31-35.
   - تحديد كائنات DTO المرتبطة: MarkPaidDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `PaymentsController.overdue` (Get /payments/overdue)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/payments/payments.controller.ts` الأسطر 38-41.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `PaymentsController.sendReminder` (Post /payments/:id/send-reminder)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/payments/payments.controller.ts` الأسطر 45-49.
   - تحديد كائنات DTO المرتبطة: SendReminderDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

---

## العقارات

### خطة لـ `ExcelController.importExcel` (Post /properties/import)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/properties/excel.controller.ts` الأسطر 23-51.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `ExcelController.importConfirm` (Post /properties/import/confirm)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/properties/excel.controller.ts` الأسطر 55-69.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `ExcelController.exportExcel` (Get /properties/export)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/properties/excel.controller.ts` الأسطر 73-104.
   - تحديد كائنات DTO المرتبطة: FilterPropertiesDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `MediaController.signedUrl` (Post /media/signed-url)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/properties/media.controller.ts` الأسطر 14-36.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `MediaController.addImage` (Post /properties/:id/images)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/properties/media.controller.ts` الأسطر 39-45.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `MediaController.setFeatured` (Patch /properties/:propertyId/images/:imageId)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/properties/media.controller.ts` الأسطر 48-51.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `MediaController.removeImage` (Delete /properties/:propertyId/images/:imageId)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/properties/media.controller.ts` الأسطر 54-57.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `PropertiesController.list` (Get /properties)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/properties/properties.controller.ts` الأسطر 18-22.
   - تحديد كائنات DTO المرتبطة: FilterPropertiesDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `PropertiesController.getOne` (Get /properties/:id)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/properties/properties.controller.ts` الأسطر 25-29.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `PropertiesController.create` (Post /properties)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/properties/properties.controller.ts` الأسطر 33-38.
   - تحديد كائنات DTO المرتبطة: CreatePropertyDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `PropertiesController.update` (Patch /properties/:id)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/properties/properties.controller.ts` الأسطر 42-46.
   - تحديد كائنات DTO المرتبطة: UpdatePropertyDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `PropertiesController.softDelete` (Delete /properties/:id)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/properties/properties.controller.ts` الأسطر 50-54.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `PublicController.listings` (Get /public/offices/:officeCode/listings)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/properties/public.controller.ts` الأسطر 12-15.
   - تحديد كائنات DTO المرتبطة: FilterPropertiesDto
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `PublicController.bySlug` (Get /public/offices/:officeCode/properties/:slug)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/properties/public.controller.ts` الأسطر 18-21.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

---

## وصول Supabase

---

## واتساب

### خطة لـ `WhatsAppController.verify` (Get /whatsapp/webhook)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/whatsapp/whatsapp.controller.ts` الأسطر 19-27.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `WhatsAppController.webhook` (Post /whatsapp/webhook)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/whatsapp/whatsapp.controller.ts` الأسطر 30-71.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `WhatsAppController.connect` (Post /whatsapp/connect)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/whatsapp/whatsapp.controller.ts` الأسطر 75-111.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `WhatsAppController.sendTemplate` (Post /whatsapp/send-template)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/whatsapp/whatsapp.controller.ts` الأسطر 115-134.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

### خطة لـ `WhatsAppController.templates` (Get /whatsapp/templates)

1. **تحليل الأثر**
   - مراجعة منطق المتحكم في `/workspace/api/src/whatsapp/whatsapp.controller.ts` الأسطر 137-142.
   - تحديد كائنات DTO المرتبطة: 
   - رسم الاعتماديات نحو الخدمات عبر حقن الاعتماديات.
2. **تحديث التصميم**
   - إعداد تعديلات OpenAPI ومزامنتها مع `API_USAGE_GUIDE.md`.
   - توسيع التحقق في DTO باستخدام زخارف class-validator حسب الحاجة.
3. **خطوات التنفيذ**
   - تحديث منطق المتحكم مع الحفاظ على الحمايات والأدوار.
   - تعديل الخدمات واستعلامات Supabase مع التأكد من توفر الفهارس.
   - تحديث مكونات الواجهة الأمامية لتستهلك المخطط الجديد.
4. **الاختبار والتحقق**
   - كتابة اختبارات وحدة للمتحكم والخدمة.
   - تسجيل اختبارات تكامل شاملة عبر Postman أو Pact.
   - تحديث خطوط CI عند تغير العقود.
5. **قائمة النشر**
   - تطبيق الترقيات أو تغييرات SQL في Supabase.
   - مراقبة السجلات والتحليلات لاكتشاف الانحرافات.

---
